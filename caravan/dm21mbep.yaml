substitutions:
  devicename: dm21mbep
  upper_devicename: DM21MBEP
  blue_led_pin: GPIO2 #D4
  tx_pin: GPIO1 # TX
  rx_pin: GPIO3 # RX
  baud_rate: "115200"
  stop_bits: "1"
#  flow_control_pin: GPIO5
  send_wait_time: "500ms"
  command_throttle: "0ms"
  update_interval: "60s"
  skip_updates: "5"
  
esphome: !include ../base/name_onboot.yaml
esp8266: !include ../esp8266/d1mini.yaml
wifi: !include ../connection/wifi_caravan.yaml
mqtt: !include ../connection/mqtt_caravan.yaml
# Enable logging
logger: !include ../logger/debug_no_uart.yaml
# Expose some info to HA
text_sensor:
  - <<: !include ../text_sensor/wifi_info.yaml
ota:
# Enable remote restart from HA
button: !include ../button/restart.yaml
light: !include ../light/blue_led.yaml
output: !include ../output/blue_led.yaml
# Modbus setup
uart: !include ../uart/uart_modbus.yaml
modbus: !include ../connection/modbus1_noflow.yaml
modbus_controller: !include ../connection/modbus1_controller_epever.yaml
# EPEver Setup
# Order is important for Modbus efficiency
sensor:
  - <<: !include ../sensor/epever_charging_mode.yaml
  - <<: !include ../sensor/epever_array_input_voltage.yaml
  - <<: !include ../sensor/epever_array_input_current.yaml
  - <<: !include ../sensor/epever_array_input_power.yaml
  - <<: !include ../sensor/epever_charging_voltage.yaml
  - <<: !include ../sensor/epever_charging_current.yaml
  - <<: !include ../sensor/epever_charging_power.yaml
  - <<: !include ../sensor/epever_battery_temperature.yaml
  - <<: !include ../sensor/epever_device_temperature.yaml
  - <<: !include ../sensor/epever_power_components_temperature.yaml
  - <<: !include ../sensor/epever_battery_soc.yaml
  - <<: !include ../sensor/epever_battery_status.yaml
  - <<: !include ../sensor/epever_charger_status.yaml
  - <<: !include ../sensor/epever_max_pv_voltage_today.yaml
  - <<: !include ../sensor/epever_min_pv_voltage_today.yaml
  - <<: !include ../sensor/epever_max_battery_voltage_today.yaml
  - <<: !include ../sensor/epever_min_battery_voltage_today.yaml
  - <<: !include ../sensor/epever_generated_energy_today.yaml
  - <<: !include ../sensor/epever_battery_voltage.yaml
  - <<: !include ../sensor/epever_battery_current.yaml

    
